<odoo>

    <record id="repair_order_form_product_history" model="ir.ui.view">
        <field name="name">repair.order.product.history.form</field>
        <field name="model">mrp.repair</field>
        <field name="inherit_id" ref="mrp_repair.view_repair_order_form"/>
        <field name="arch" type="xml">
            <button name="action_created_invoice" position="before">
                <button type="object"  name="action_view_invoice"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        string="Origin Inv"
                        context="{'search_default_partner_id': partner_id}"
                        attrs="{'invisible': [('reference_move_id','=', False)]}">
                </button>
            </button>
            <xpath expr="//field[@name='partner_id']" position="replace">
            </xpath>
            <field name ="product_id" position="before">
                <field name="partner_id"/>
                <field name="product_brand" nolabel="1"/>
                <field name="product_category" nolabel="1"/>
            </field>
            <field name="partner_id" position="after">
                <field name="reference_move_id"
                   options="{'no_create': True}"
                   domain="['&amp;', '|', ('state', '=', 'done'), ('state', '=', 'done'), '|',
                            ('picking_id.partner_id', '=', partner_id),
                            ('picking_id.partner_id', 'child_of', partner_id)]"
                   attrs="{'invisible': [('partner_id', '=', False)]}"/>
                <field name="invoice_line_id"
                    options="{'no_create': True}"
                    domain="['|',
                      ('invoice_id.partner_id', '=', partner_id),
                      ('invoice_id.partner_id', 'child_of', partner_id)]"
                    attrs="{'invisible': ['|',
                      ('partner_id', '=', False),
                      ('state', '!=', 'draft')]}"/>
            </field>
            <field name="lot_id" position="after">
                <field name="currency_id" invisible="1"/>
                <field name="amount_repair_until" widget="monetary" options="{'currency_field': 'currency_id', 'field_digits': True}"/>
            </field>
            <field name="pricelist_id" position="after">
                <field name="technician"/>
                <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}"/>
                <field name="helpdesk_ticket_id"/>
                <field name="repair_type"/>
           </field>
           <field name="internal_notes" position="before">
                <h3>Internal Notes</h3>
           </field>
           <field name="quotation_notes" position="before">
                <h3>Error Description</h3>
           </field>
           <!-- Invisible Stock Lockations -->
           <xpath expr="//field[@name='location_id']" position="attributes">
                <attribute name="invisible">1</attribute>
           </xpath>
           <xpath expr="//field[@name='location_dest_id']" position="attributes">
                <attribute name="invisible">1</attribute>
           </xpath>
        </field>
    </record>

    <!-- Search views -->
    <record id="Helpdesk_ticket_repair_search" model="ir.ui.view">
        <field name="name">Helpdesk Ticket</field>
        <field name="model">mrp.repair</field>
        <field name="inherit_id" ref="mrp_repair.view_repair_order_form_filter"/>
        <field name="arch" type="xml">
            <!-- Add helpdesk to search view to be able to use search_default -->
            <field name="name" position="after">
                <field name="helpdesk_ticket_id" string="Helpdesk Ticket" invisible="1"/>
            </field>
            <field name="partner_id" position="after">
                <field name="technician" string="Technician"/>
            </field>
            <filter name="activities_my" position="after">
                <filter string="My Repair Orders" name="user_repair_orders" domain="[('technician','=',uid)]"/>
            </filter>
            <xpath expr="//group" position="inside">
                <filter string="Technician" domain="[]" context="{'group_by':'technician'}"/>
            </xpath>
      </field>
    </record>

    <!-- List Views -->
    <!-- TODO: Set Kanban as default -->
    <record id="repair_extensions_list_view" model="ir.ui.view">
        <field name="name">Repair Orders</field>
        <field name="model">mrp.repair</field>
        <field name="inherit_id" ref="mrp_repair.view_repair_order_tree"/>
        <field name="arch" type="xml">
            <!-- Add helpdesk to search view to be able to use search_default -->
            <field name="state" position="after">
                <field name="technician" string="Technician"/>
            </field>
      </field>
    </record>

    <!-- Repair Tag Views -->
    <record id="mrp_repair_tag_form" model="ir.ui.view">
        <field name="name">mrp.repair.tag.form</field>
        <field name="model">mrp.repair.tag</field>
        <field name="arch" type="xml">
            <form string="Repair Tags">
                <group>
                    <field name="name"/>
                    <field name="color" groups="base.group_no_one"/>
                </group>
            </form>
        </field>
    </record>

    <record id="mrp_repair_tag_tree" model="ir.ui.view">
        <field name="name">mrp.repair.tag.tree</field>
        <field name="model">mrp.repair.tag</field>
        <field name="arch" type="xml">
            <tree string="Repair Tags">
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record id="action_repair_tags" model="ir.actions.act_window">
        <field name="name">Repair Order Tags</field>
        <field name="res_model">mrp.repair.tag</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
              Click to create a new Tag
            </p><p>
              Tags allow to organize Repair Orders
            </p>
        </field>
    </record>

    <!-- Stage Menu Views -->
    <record id="mrp_repair_stages_view_tree" model="ir.ui.view">
        <field name="name">mrp.repair.stages.tree</field>
        <field name="model">mrp.repair.stage</field>
        <field name="arch" type="xml">
            <tree string="Stages" >
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="is_close"/>
                <field name="fold"/>
            </tree>
        </field>
    </record>

    <record id="mrp_repair_stage_view_form" model="ir.ui.view">
        <field name="name">mrp.repair.stage.form</field>
        <field name="model">mrp.repair.stage</field>
        <field name="arch" type="xml">
            <form string="Stage Search">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="sequence" groups="base.group_no_one"/>
                        </group>
                        <group>
                            <field name="is_close"/>
                            <field name="fold"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_repair_stages" model="ir.actions.act_window">
        <field name="name">Repair Order Stages</field>
        <field name="res_model">mrp.repair.stage</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
              Click to create a new Stages
            </p><p>
              Stages allow to organize Repair Orders
            </p>
        </field>
    </record>

    <!-- Repair Type Menu Views -->
    <record id="mrp_repair_type_view_tree" model="ir.ui.view">
        <field name="name">mrp.repair.type.tree</field>
        <field name="model">mrp.repair.type</field>
        <field name="arch" type="xml">
            <tree string="Repair Types">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="invoice_method"/>
                <field name="invoice_address"/>
                <field name="tag_ids"/>
                <field name="kanban_color"/>
            </tree>
        </field>
    </record>

    <record id="mrp_repair_stage_view_form" model="ir.ui.view">
        <field name="name">mrp.repair.type.form</field>
        <field name="model">mrp.repair.type</field>
        <field name="arch" type="xml">
            <form string="Stage Search">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="sequence" groups="base.group_no_one"/>
                            <field name="invoice_method"/>
                            <field name="invoice_address"/>
                        </group>
                        <group>
                            <field name="technician"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" help="Tags to set by default"/>
                            <field name="kanban_color" help="Default Color for Kanban View"/>
                            <field name="active" widget="checkbox"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_repair_types" model="ir.actions.act_window">
        <field name="name">Repair Order Types</field>
        <field name="res_model">mrp.repair.type</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
              Click to create a new Type
            </p><p>
              Types allow to set certain fields by default based on type of Repair Orders
            </p>
        </field>
    </record>


    <!-- Menuitems -->
    <menuitem id="repair_menu_config" name="Configuration" sequence="100" parent="mrp_repair.menu_repair_order"
        groups="base.group_system"/>
    <menuitem id="repair_menu_tags" name="Tags" sequence="80" parent="repair_menu_config" action="action_repair_tags"/>
    <menuitem id="repair_menu_stages" name="Stages" sequence="90" parent="repair_menu_config" action="action_repair_stages"/>
    <menuitem id="repair_menu_types" name="Repair Types" sequence="100" parent="repair_menu_config" action="action_repair_types"/>

</odoo>
